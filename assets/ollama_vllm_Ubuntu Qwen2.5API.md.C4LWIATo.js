import{_ as i,c as t,o as e,ag as n,j as s}from"./chunks/framework.oP1PDRBo.js";const k=JSON.parse('{"title":"Qwen2.5-Coder-7B-Instruct-AWQæ¨¡å‹","description":"","frontmatter":{},"headers":[],"relativePath":"ollama/vllm/Ubuntu Qwen2.5API.md","filePath":"ollama/vllm/Ubuntu Qwen2.5API.md","lastUpdated":1744448235000}'),p={name:"ollama/vllm/Ubuntu Qwen2.5API.md"};function l(o,a,h,d,r,c){return e(),t("div",null,a[0]||(a[0]=[n(`<h1 id="qwen2-5-coder-7b-instruct-awqæ¨¡å‹" tabindex="-1">Qwen2.5-Coder-7B-Instruct-AWQæ¨¡å‹ <a class="header-anchor" href="#qwen2-5-coder-7b-instruct-awqæ¨¡å‹" aria-label="Permalink to &quot;Qwen2.5-Coder-7B-Instruct-AWQæ¨¡å‹&quot;">â€‹</a></h1><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨VLLMéƒ¨ç½²Qwen2.5-Coder-7B-Instruct-AWQæ¨¡å‹å¹¶é€šè¿‡PyCharmè°ƒç”¨å…¶APIçš„åˆ†æ­¥æŒ‡å—ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ç¡®ä¿æ¨¡å‹ç›®å½•åŒ…å«ï¼š</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">model.safetensors</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # å¿…é¡»å­˜åœ¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">config.json</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # å¿…é¡»åŒ…å«&quot;quantization_config&quot;å­—æ®µ</span></span></code></pre></div><p>ç¡¬ä»¶è¦æ±‚ï¼š</p><table tabindex="0"><thead><tr><th style="text-align:left;">ç»„ä»¶</th><th style="text-align:left;">æœ€ä½è¦æ±‚</th><th style="text-align:left;">æ¨èé…ç½®</th></tr></thead><tbody><tr><td style="text-align:left;">GPU</td><td style="text-align:left;">NVIDIA GTX 1080 (8GB)</td><td style="text-align:left;">RTX 3090 (24GB)</td></tr><tr><td style="text-align:left;">RAM</td><td style="text-align:left;">16GB</td><td style="text-align:left;">32GB+</td></tr><tr><td style="text-align:left;">VRAM</td><td style="text-align:left;">8GB</td><td style="text-align:left;">16GB+</td></tr></tbody></table><p>æ€§èƒ½ä¼˜åŒ–å‚æ•°ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¯åŠ¨æœåŠ¡å™¨æ—¶æ·»åŠ è¿™äº›å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--tensor-parallel-size</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # å¤šGPUå¹¶è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--gpu-memory-utilization</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.9</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # æ˜¾å­˜åˆ©ç”¨ç‡</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--max-num-seqs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 64</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # æé«˜å¹¶å‘å¤„ç†é‡</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--enforce-eager</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # å°æ˜¾å­˜æ¨¡å¼</span></span></code></pre></div><h2 id="_1-ç¯å¢ƒæ¸…ç†ä¸å‡†å¤‡" tabindex="-1">1.ç¯å¢ƒæ¸…ç†ä¸å‡†å¤‡ <a class="header-anchor" href="#_1-ç¯å¢ƒæ¸…ç†ä¸å‡†å¤‡" aria-label="Permalink to &quot;1.ç¯å¢ƒæ¸…ç†ä¸å‡†å¤‡&quot;">â€‹</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># åˆ›å»ºçº¯å‡€è™šæ‹Ÿç¯å¢ƒï¼ˆé¿å…æ—§ä¾èµ–å¹²æ‰°ï¼‰</span></span>
<span class="line"><span>python -m venv vllm_env</span></span></code></pre></div><h2 id="_2-ç¡®è®¤è™šæ‹Ÿç¯å¢ƒæ¿€æ´»" tabindex="-1">2.ç¡®è®¤è™šæ‹Ÿç¯å¢ƒæ¿€æ´» <a class="header-anchor" href="#_2-ç¡®è®¤è™šæ‹Ÿç¯å¢ƒæ¿€æ´»" aria-label="Permalink to &quot;2.ç¡®è®¤è™šæ‹Ÿç¯å¢ƒæ¿€æ´»&quot;">â€‹</a></h2><div class="language-Linux vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Linux</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>source vllm_env/bin/activate</span></span></code></pre></div><h2 id="_3-å®‰è£…ä¾èµ–" tabindex="-1">3.å®‰è£…ä¾èµ– <a class="header-anchor" href="#_3-å®‰è£…ä¾èµ–" aria-label="Permalink to &quot;3.å®‰è£…ä¾èµ–&quot;">â€‹</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># å®‰è£…vLLM 0.8.2ï¼ˆéœ€ä¸numpy&lt;2.0å…¼å®¹ï¼‰</span></span>
<span class="line"><span>pip install vllm==0.8.2</span></span></code></pre></div><p>å®‰è£…å¿…è¦çš„åº“ï¼Œæ¯”å¦‚vllmå’Œopenaiã€‚</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>pip install  openai</span></span></code></pre></div><h2 id="_4-å¯åŠ¨vllm-apiæœåŠ¡å™¨" tabindex="-1">4.å¯åŠ¨VLLM APIæœåŠ¡å™¨ <a class="header-anchor" href="#_4-å¯åŠ¨vllm-apiæœåŠ¡å™¨" aria-label="Permalink to &quot;4.å¯åŠ¨VLLM APIæœåŠ¡å™¨&quot;">â€‹</a></h2><h4 id="åœ¨ubuntuç»ˆç«¯å¯åŠ¨apiæœåŠ¡å™¨" tabindex="-1">åœ¨Ubuntuç»ˆç«¯å¯åŠ¨APIæœåŠ¡å™¨ï¼š <a class="header-anchor" href="#åœ¨ubuntuç»ˆç«¯å¯åŠ¨apiæœåŠ¡å™¨" aria-label="Permalink to &quot;åœ¨Ubuntuç»ˆç«¯å¯åŠ¨APIæœåŠ¡å™¨ï¼š&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>python -m vllm.entrypoints.openai.api_server --model /home/modern/models/Qwen/Qwen2.5-Coder-7B-Instruct-AWQ --quantization awq --host 0.0.0.0 --port 8000</span></span></code></pre></div><p>å‚æ•°è¯´æ˜â€Œï¼š --model: æ¨¡å‹è·¯å¾„ï¼ˆéœ€æ›¿æ¢ä¸ºå®é™…è·¯å¾„ï¼‰ã€‚ --quantization awq: å¯ç”¨AWQé‡åŒ–åŠ é€Ÿã€‚</p><p>--allowed-origins &#39;[&quot;*&quot;]&#39; # JSON æ•°ç»„æ ¼å¼ å…è®¸æ‰€æœ‰åŸŸå</p><p>--host 0.0.0.0: å…è®¸å¤–éƒ¨è®¿é—®ã€‚ --port 8000: æŒ‡å®šAPIç«¯å£ã€‚</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>python -m vllm.entrypoints.openai.api_server --model /home/modern/models/Qwen/Qwen2.5-Coder-7B-Instruct-AWQ --quantization awq_marlin --host 0.0.0.0 --port 8000 --generation-config vllm  --served-model-name MyCoder</span></span></code></pre></div><p>å¯åŠ¨æ—¶æŒ‡å®šï¼š</p><p>è‡ªå®šä¹‰APIç«¯ç‚¹ï¼š--served-model-name MyCoder</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>--served-model-name MyCoder  # è‡ªå®šä¹‰æ¨¡å‹åç§°</span></span></code></pre></div><p>--served-model-name MyCoder \\ # ä¸APIè¯·æ±‚ä¸­çš„modelå‚æ•°ä¸€è‡´</p><p>--generation-config vllm</p><p>--quantization awq_marlin è¯¥æ¨¡å‹åœ¨è¿è¡Œæ—¶å¯è½¬æ¢ä¸ºawq_marlinã€‚ä½¿ç”¨awq_marlinå†…æ ¸ã€‚</p>`,28),s("p",{"reward,":"","embed,":"","generate,":"","score,":"",classify:""},null,-1),s("p",null,"æ­¤æ¨¡å‹æ”¯æŒå¤šç§ä»»åŠ¡ï¼š{â€œè½¬å‘â€ã€â€œåµŒå…¥â€ã€â€œç”Ÿæˆâ€ã€â€œè¯„åˆ†â€ã€â€œåˆ†ç±»â€}ã€‚é»˜è®¤ä¸ºâ€œç”Ÿæˆâ€ã€‚",-1),s("p",{"repetition_penalty:":"","1.1,":"","temperature:":"","0.7,":"","top_k:":"","20,":"","top_p:":"","0.8":""},"Using default chat sampling params from model:",-1),n(`<p>â€˜é‡å¤æƒ©ç½šâ€™ï¼š1.1ï¼Œ â€œæ¸©åº¦â€ï¼š0.7ï¼Œ &#39;top_k&#39;ï¼š20ï¼Œ &#39;top_p&#39;ï¼š0.8</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>INFO 03-28 08:19:16 [api_server.py:1028] Starting vLLM API server on http://0.0.0.0:8000</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:26] Available routes are:</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:34] Route: /openapi.json, Methods: GET, HEAD</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:34] Route: /docs, Methods: GET, HEAD</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:34] Route: /docs/oauth2-redirect, Methods: GET, HEAD</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:34] Route: /redoc, Methods: GET, HEAD</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:34] Route: /health, Methods: GET</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:34] Route: /load, Methods: GET</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:34] Route: /ping, Methods: POST, GET</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:34] Route: /tokenize, Methods: POST</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:34] Route: /detokenize, Methods: POST</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:34] Route: /v1/models, Methods: GET</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:34] Route: /version, Methods: GET</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:34] Route: /v1/chat/completions, Methods: POST</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:34] Route: /v1/completions, Methods: POST</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:34] Route: /v1/embeddings, Methods: POST</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:34] Route: /pooling, Methods: POST</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:34] Route: /score, Methods: POST</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:34] Route: /v1/score, Methods: POST</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:34] Route: /v1/audio/transcriptions, Methods: POST</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:34] Route: /rerank, Methods: POST</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:34] Route: /v1/rerank, Methods: POST</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:34] Route: /v2/rerank, Methods: POST</span></span>
<span class="line"><span>INFO 03-28 08:19:16 [launcher.py:34] Route: /invocations, Methods: POST</span></span>
<span class="line"><span>INFO:     Started server process [709]</span></span>
<span class="line"><span>INFO:     Waiting for application startup.</span></span>
<span class="line"><span>INFO:     Application startup complete.</span></span></code></pre></div><p>ç‚¹å‡»è¿è¡ŒæŒ‰é’®ï¼Œæ§åˆ¶å°è¾“å‡º <code>INFO: Application startup complete</code> è¡¨ç¤ºå¯åŠ¨æˆåŠŸã€‚</p><h2 id="_5-ç¼–å†™pycharmä¸­åˆ›å»ºå®¢æˆ·ç«¯æ–‡ä»¶" tabindex="-1">5.ç¼–å†™PyCharmä¸­åˆ›å»ºå®¢æˆ·ç«¯æ–‡ä»¶ï¼š <a class="header-anchor" href="#_5-ç¼–å†™pycharmä¸­åˆ›å»ºå®¢æˆ·ç«¯æ–‡ä»¶" aria-label="Permalink to &quot;5.ç¼–å†™PyCharmä¸­åˆ›å»ºå®¢æˆ·ç«¯æ–‡ä»¶ï¼š&quot;">â€‹</a></h2><h3 id="é…ç½®-pycharmâ€Œ" tabindex="-1">é…ç½® PyCharmâ€Œ <a class="header-anchor" href="#é…ç½®-pycharmâ€Œ" aria-label="Permalink to &quot;é…ç½® PyCharmâ€Œ&quot;">â€‹</a></h3><ol><li>åœ¨ PyCharm ä¸­æ‰“å¼€é¡¹ç›®ï¼Œè¿›å…¥ <code>File &gt; Settings &gt; Project: &lt;é¡¹ç›®å&gt; &gt; Python Interpreter</code>ã€‚</li><li>ç‚¹å‡»é½¿è½®å›¾æ ‡é€‰æ‹© <code>Add Interpreter &gt; Existing</code>ã€‚</li><li>æ‰¾åˆ°è™šæ‹Ÿç¯å¢ƒçš„ Python è§£é‡Šå™¨è·¯å¾„ï¼ˆä¾‹å¦‚ <code>~/vllm_env/bin/python</code>ï¼‰ã€‚</li></ol><h4 id="ç½‘ç»œé…ç½®â€Œ" tabindex="-1">ç½‘ç»œé…ç½®â€Œï¼š <a class="header-anchor" href="#ç½‘ç»œé…ç½®â€Œ" aria-label="Permalink to &quot;ç½‘ç»œé…ç½®â€Œï¼š&quot;">â€‹</a></h4><p>è‹¥VLLMæœåŠ¡éƒ¨ç½²åœ¨è¿œç¨‹æœåŠ¡å™¨ï¼Œéœ€å°† localhost æ›¿æ¢ä¸ºæœåŠ¡å™¨IPï¼Œå¹¶ç¡®ä¿é˜²ç«å¢™å¼€æ”¾ç«¯å£ï¼ˆå¦‚8000ï¼‰ã€‚</p><p>é”™è¯¯æ’æŸ¥â€Œï¼šæ£€æŸ¥VLLMæ—¥å¿—ï¼ˆvllm.logï¼‰æ˜¯å¦æœ‰å¯åŠ¨é”™è¯¯ã€‚ æµ‹è¯•APIè¿é€šæ€§ï¼šcurl <a href="http://172.18.15.27:8000/v1/models" target="_blank" rel="noreferrer">http://172.18.15.27:8000/v1/models</a></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>{&quot;object&quot;:&quot;list&quot;,&quot;data&quot;:[{&quot;id&quot;:&quot;/home/modern/models/Qwen/Qwen2.5-Coder-7B-Instruct-AWQ&quot;,&quot;object&quot;:&quot;model&quot;,&quot;created&quot;:1743128501,&quot;owned_by&quot;:&quot;vllm&quot;,&quot;root&quot;:&quot;/home/modern/models/Qwen/Qwen2.5-Coder-7B-Instruct-AWQ&quot;,&quot;parent&quot;:null,&quot;max_model_len&quot;:32768,&quot;permission&quot;:[{&quot;id&quot;:&quot;modelperm-e3b9d839f2de483187de047503f31f1f&quot;,&quot;object&quot;:&quot;model_permission&quot;,&quot;created&quot;:1743128501,&quot;allow_create_engine&quot;:false,&quot;allow_sampling&quot;:true,&quot;allow_logprobs&quot;:true,&quot;allow_search_indices&quot;:false,&quot;allow_view&quot;:true,&quot;allow_fine_tuning&quot;:false,&quot;organization&quot;:&quot;*&quot;,&quot;group&quot;:null,&quot;is_blocking&quot;:false}]}]}</span></span></code></pre></div><p>æä¾›æœåŠ¡ç«¯çš„å®Œæ•´å¯åŠ¨å‘½ä»¤</p><p>curl <a href="http://172.18.15.27:8000/v1/models" target="_blank" rel="noreferrer">http://172.18.15.27:8000/v1/models</a> çš„è¾“å‡ºç»“æœ</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>{&quot;object&quot;:&quot;list&quot;,&quot;data&quot;:[{&quot;id&quot;:&quot;MyCoder&quot;,&quot;object&quot;:&quot;model&quot;,&quot;created&quot;:1743145239,&quot;owned_by&quot;:&quot;vllm&quot;,&quot;root&quot;:&quot;/home/modern/models/Qwen/Qwen2.5-Coder-7B-Instruct-AWQ&quot;,&quot;parent&quot;:null,&quot;max_model_len&quot;:32768,&quot;permission&quot;:[{&quot;id&quot;:&quot;modelperm-02048ca2299f4ce89ac9a57253c52d57&quot;,&quot;object&quot;:&quot;model_permission&quot;,&quot;created&quot;:1743145239,&quot;allow_create_engine&quot;:false,&quot;allow_sampling&quot;:true,&quot;allow_logprobs&quot;:true,&quot;allow_search_indices&quot;:false,&quot;allow_view&quot;:true,&quot;allow_fine_tuning&quot;:false,&quot;organization&quot;:&quot;*&quot;,&quot;group&quot;:null,&quot;is_blocking&quot;:false}]}]}</span></span></code></pre></div><p>æ‰©å±•åŠŸèƒ½â€Œ</p><p>è°ƒæ•´ç”Ÿæˆå‚æ•°â€Œï¼š ä¿®æ”¹APIè¯·æ±‚ä¸­çš„ temperature, top_p, max_tokens ç­‰å‚æ•°æ§åˆ¶ç”Ÿæˆç»“æœã€‚</p><p><code>top_p</code>ã€<code>top_k</code> ä»¥åŠ <code>temperature</code> éƒ½æ˜¯ä¸å¤§è¯­è¨€æ¨¡å‹ç”Ÿæˆæ–‡æœ¬è¿‡ç¨‹ç›¸å…³çš„é‡‡æ ·å‚æ•°ã€‚ä»¥ä¸‹æ˜¯å¯¹æ¯ä¸ªå‚æ•°çš„è§£é‡Šï¼š</p><p>å‚æ•°ç»„åˆç­–ç•¥ ä¿å®ˆç”Ÿæˆï¼ˆä»£ç /äº‹å®ç±»ï¼‰ï¼š top_p=0.8 top_k=30 temperature=0.3 åˆ›æ„ç”Ÿæˆï¼ˆæ•…äº‹/æ–‡æ¡ˆç±»ï¼‰ï¼š top_p=0.95 top_k=0 # ç¦ç”¨ top_k temperature=1.0 å¹³è¡¡æ¨¡å¼ï¼ˆé€šç”¨å¯¹è¯ï¼‰ï¼š top_p=0.9 top_k=50 temperature=0.7</p><p>æ³¨æ„ï¼šä¸ top_k äºŒé€‰ä¸€ä½¿</p><ol><li><p><strong><code>repetition_penalty</code>:</strong></p><ul><li>ä¸­æ–‡å«ä¹‰ï¼šé‡å¤æƒ©ç½š</li><li>ä½œç”¨ï¼šç”¨äºæ§åˆ¶æ¨¡å‹åœ¨ç”Ÿæˆæ–‡æœ¬æ—¶å¯¹é‡å¤ä½¿ç”¨ç›¸åŒè¯æ±‡æˆ–çŸ­è¯­çš„é™åˆ¶ã€‚</li><li>è§£é‡Šï¼šè¾ƒé«˜çš„ <code>repetition_penalty</code> å€¼ä¼šå‡å°‘æ¨¡å‹é‡å¤ç›¸ä¼¼å†…å®¹çš„å¯èƒ½æ€§ï¼Œä»è€Œé™ä½ç»“æœä¸­å‡ºç°é‡å¤è¯è¯­çš„é£é™©ã€‚</li></ul></li><li><p><strong><code>temperature</code>:</strong></p><ul><li>ä¸­æ–‡å«ä¹‰ï¼šæ¸©åº¦</li><li>ä½œç”¨ï¼šæ§åˆ¶ç”Ÿæˆæ–‡æœ¬çš„éšæœºæ€§å’Œåˆ›é€ æ€§ç¨‹åº¦ã€‚</li><li>è§£é‡Šï¼š <ul><li>æ¸©åº¦è¾ƒé«˜ï¼ˆä¾‹å¦‚ 0.9ï¼‰æ—¶ï¼Œæ¨¡å‹ä¼šæ›´åŠ éšæœºå’Œå¯Œæœ‰åˆ›é€ åŠ›ï¼Œå¯èƒ½ä¼šè·³è„±å‡ºå¸¸è§„æ€ç»´è¿›è¡Œåˆ›ä½œã€‚ä½†è‹¥æ¸©åº¦è¿‡é«˜ï¼ˆå¦‚æ¥è¿‘æˆ–è¶…è¿‡ 1ï¼‰ï¼Œå¯èƒ½å¯¼è‡´è¾“å‡ºçš„å†…å®¹ä¸å¤Ÿè¿è´¯ï¼Œç”šè‡³å‡ºç°æ€ªå¼‚çš„ç»“æœã€‚</li><li>æ¸©åº¦è¾ƒä½ï¼ˆä¾‹å¦‚ 0.3ï¼‰æ—¶ï¼Œæ¨¡å‹çš„å†³ç­–æ›´åŠ ä¿å®ˆå’Œç¡®å®šæ€§ï¼Œå€¾å‘äºé€‰æ‹©è¾ƒä¸ºå¸¸è§å’Œåˆç†çš„è¡¨è¾¾æ–¹å¼ï¼Œè¾“å‡ºæ›´åŠ ç¨³å®šå’Œæ”¶æ•›ã€‚</li></ul></li></ul></li><li><p><strong><code>top_k</code>:</strong></p><ul><li>ä¸­æ–‡å«ä¹‰ï¼šé™åˆ¶å€™é€‰è¯æ•°é‡ï¼Œé˜²æ­¢ç”Ÿæˆé‡å¤å†…å®¹</li><li>æ¨èå€¼åŸŸï¼š20~100</li><li>ä½œç”¨ï¼šåœ¨ç”Ÿæˆä¸‹ä¸€ä¸ªè¯æ—¶ï¼Œä»æ‰€æœ‰å¯èƒ½å€™é€‰ä¸­éšæœºé€‰æ‹©å‰ k ä¸ªæ¦‚ç‡æœ€é«˜çš„è¯æ±‡ã€‚</li><li>è§£é‡Šï¼š <ul><li>è¾ƒå°çš„ <code>top_k</code> å€¼ï¼ˆæ¯”å¦‚ 10ï¼‰ä¼šä½¿æ¨¡å‹é€‰æ‹©èŒƒå›´è¾ƒçª„ï¼Œè¾“å‡ºæ›´åŠ é›†ä¸­å’Œä¿å®ˆã€‚</li><li>è¾ƒå¤§çš„ <code>top_k</code> å€¼ï¼ˆæ¯”å¦‚ 50 æˆ–æ›´é«˜ï¼‰ä¼šè®©æ¨¡å‹æœ‰æ›´å¤šé€‰æ‹©ä½™åœ°ï¼Œä»è€Œç”Ÿæˆæ›´åŠ å¤šæ ·åŒ–ä¸”æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚</li></ul></li></ul></li><li><p><strong><code>top_p</code>:</strong></p><ul><li>ä¸­æ–‡å«ä¹‰ï¼šæ ¸é‡‡æ ·ï¼ˆæ¦‚ç‡ç´¯ç§¯é˜ˆå€¼ï¼‰</li><li>æ¨èå€¼åŸŸï¼š0.5~0.95</li><li>ä½œç”¨ï¼šåŸºäºè¯æ±‡çš„æ¦‚ç‡ç´¯ç§¯å’Œï¼Œåªåœ¨æ‰€æœ‰å€™é€‰ä¸­é€‰æ‹©æ¦‚ç‡ç´¯ç§¯å’Œè¶…è¿‡ <code>p%</code> çš„èŒƒå›´å†…çš„è¯æ±‡ã€‚</li><li>è§£é‡Šï¼š <ul><li>è¾ƒå°çš„ <code>top_p</code> å€¼ï¼ˆä¾‹å¦‚ 0.2ï¼‰ä¼šæå¤§åœ°é™åˆ¶ç”Ÿæˆçš„å†…å®¹ï¼Œå‡å°‘ç»“æœçš„å¤šæ ·æ€§ã€‚</li><li>è¾ƒå¤§çš„ <code>top_p</code> å€¼ï¼ˆä¾‹å¦‚ 0.8 æˆ–æ›´é«˜ï¼‰åˆ™å…è®¸æ›´å¤šçš„è¯æ±‡é€‰æ‹©ï¼Œå¢åŠ ç”Ÿæˆå†…å®¹çš„æ–°æ„å’Œä¸å¯é¢„æµ‹æ€§ã€‚</li></ul></li></ul></li></ol><hr><p>æ€»ç»“æ¥è¯´ï¼š</p><ul><li><strong>æ¸©åº¦ (<code>temperature</code>) æ˜¯åˆ›æ„ä¸ç¨³å®šæ€§çš„å¹³è¡¡ç‚¹ã€‚</strong></li><li><strong>é¡¶éƒ¨ k (<code>top_k</code>) å’Œ é¡¶éƒ¨ p (<code>top_p</code>) éƒ½æ˜¯æ§åˆ¶å¤šæ ·æ€§çš„æ–¹å¼ï¼Œåˆ†åˆ«ä»æ•°é‡ä¸Šçš„-top k ä¸ªæˆ–æ¦‚ç‡ç´¯ç§¯çš„-top p% å€¼é€‰æ‹©å€™é€‰é¡¹ã€‚</strong></li><li><strong>é‡å¤æƒ©ç½š (<code>repetition_penalty</code>) åˆ™æ˜¯ç”¨æ¥é˜²æ­¢æ¨¡å‹åœ¨ç”Ÿæˆæ–‡æœ¬æ—¶è¿‡äºé‡å¤ä¹‹å‰çš„å†…å®¹ã€‚</strong></li></ul><p>è¿™äº›å‚æ•°å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œè°ƒæ•´ï¼Œä»è€Œå½±å“æ¨¡å‹è¾“å‡ºçš„ç»“æœé£æ ¼å’Œè´¨é‡ã€‚</p><h4 id="ç¼–å†™apiè°ƒç”¨ä»£ç â€Œ" tabindex="-1">ç¼–å†™APIè°ƒç”¨ä»£ç â€Œ <a class="header-anchor" href="#ç¼–å†™apiè°ƒç”¨ä»£ç â€Œ" aria-label="Permalink to &quot;ç¼–å†™APIè°ƒç”¨ä»£ç â€Œ&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>import requests</span></span>
<span class="line"><span>import json</span></span>
<span class="line"><span></span></span>
<span class="line"><span>url = &quot;http://172.18.15.27:8000/v1/completions&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>headers = {</span></span>
<span class="line"><span>    &quot;Content-Type&quot;: &quot;application/json&quot;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>data = {</span></span>
<span class="line"><span>    &quot;model&quot;: &quot;/home/modern/models/Qwen/Qwen2.5-Coder-7B-Instruct-AWQ&quot;,</span></span>
<span class="line"><span>    &quot;prompt&quot;: &quot;Hello, my name is&quot;,</span></span>
<span class="line"><span>    &quot;max_tokens&quot;: 9000,</span></span>
<span class="line"><span>    &quot;temperature&quot;: 0.7,</span></span>
<span class="line"><span>    &quot;top_k&quot;:50,</span></span>
<span class="line"><span>    &quot;top_p&quot;:0.8</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>response = requests.post(url, headers=headers, data=json.dumps(data))</span></span>
<span class="line"><span>print(&quot;Status Code:&quot;, response.status_code)</span></span>
<span class="line"><span>print(&quot;Response JSON:\\n&quot;, json.dumps(response.json(), indent=2))</span></span></code></pre></div><p>è¾“å‡ºå†…å®¹ä¸ºï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>D:\\WEB\\PycharmProjects\\venv\\Scripts\\python.exe D:\\WEB\\PycharmProjects\\pythonProject1\\markdown\\openai_client.py </span></span>
<span class="line"><span>Status Code: 200</span></span>
<span class="line"><span>Response JSON:</span></span>
<span class="line"><span> {</span></span>
<span class="line"><span>  &quot;id&quot;: &quot;cmpl-fda6dd053c2f421d8fec68ae3463b96f&quot;,</span></span>
<span class="line"><span>  &quot;object&quot;: &quot;text_completion&quot;,</span></span>
<span class="line"><span>  &quot;created&quot;: 1743129660,</span></span>
<span class="line"><span>  &quot;model&quot;: &quot;/home/modern/models/Qwen/Qwen2.5-Coder-7B-Instruct-AWQ&quot;,</span></span>
<span class="line"><span>  &quot;choices&quot;: [</span></span>
<span class="line"><span>    {</span></span>
<span class="line"><span>      &quot;index&quot;: 0,</span></span>
<span class="line"><span>      &quot;text&quot;: &quot; [Your Name] and I am a [Your Profession]. I am writing to you today because I am interested in learning more about [Your Area of Interest]. I believe that your expertise and knowledge in this field would be invaluable to me and I am hoping that you could share some of your insights and advice with me. I am open to any questions you may have and I am excited to learn more about this topic. Thank you for your time and consideration. Sincerely, [Your Name]&quot;,</span></span>
<span class="line"><span>      &quot;logprobs&quot;: null,</span></span>
<span class="line"><span>      &quot;finish_reason&quot;: &quot;stop&quot;,</span></span>
<span class="line"><span>      &quot;stop_reason&quot;: null,</span></span>
<span class="line"><span>      &quot;prompt_logprobs&quot;: null</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  ],</span></span>
<span class="line"><span>  &quot;usage&quot;: {</span></span>
<span class="line"><span>    &quot;prompt_tokens&quot;: 5,</span></span>
<span class="line"><span>    &quot;total_tokens&quot;: 105,</span></span>
<span class="line"><span>    &quot;completion_tokens&quot;: 100,</span></span>
<span class="line"><span>    &quot;prompt_tokens_details&quot;: null</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Process finished with exit code 0</span></span></code></pre></div><h4 id="ç¼–å†™apiè°ƒç”¨ä»£ç â€Œâ€”â€”stream" tabindex="-1">ç¼–å†™APIè°ƒç”¨ä»£ç â€Œâ€”â€”stream <a class="header-anchor" href="#ç¼–å†™apiè°ƒç”¨ä»£ç â€Œâ€”â€”stream" aria-label="Permalink to &quot;ç¼–å†™APIè°ƒç”¨ä»£ç â€Œâ€”â€”stream&quot;">â€‹</a></h4><p>æµå¼è¾“å‡ºï¼ˆstreaming responseï¼‰ï¼Œè¿™æ ·å®¢æˆ·ç«¯å¯ä»¥é€æ­¥æ¥æ”¶ç”Ÿæˆçš„å†…å®¹ï¼Œè€Œä¸æ˜¯ç­‰å¾…æ•´ä¸ªç”Ÿæˆå®Œæˆã€‚</p><p>è®¾ç½® &quot;stream&quot;: True åï¼ŒAPIä¼šæŒç»­è¿”å›ç»“æœï¼ˆé€tokenè¾“å‡ºï¼‰ï¼Œé€‚ç”¨äºéœ€è¦å®æ—¶åé¦ˆçš„åœºæ™¯ã€‚</p><p>ç”¨Pythonä»£ç è°ƒç”¨è¿™ä¸ªAPIã€‚éœ€è¦ç”¨åˆ°openaiåº“ï¼Œå¹¶é…ç½®base_urlæŒ‡å‘æœ¬åœ°è¿è¡Œçš„VLLMæœåŠ¡å™¨ï¼Œä»¥åŠæ­£ç¡®çš„APIå¯†é’¥ï¼ˆè™½ç„¶VLLMå¯èƒ½ä¸éœ€è¦ï¼Œä½†ä¸ºäº†å…¼å®¹æ€§å¯èƒ½éœ€è¦è®¾ç½®ä¸€ä¸ªè™šæ‹Ÿçš„ï¼‰ã€‚åŒæ—¶ï¼Œå¤„ç†æµå¼å“åº”éœ€è¦åœ¨å®¢æˆ·ç«¯å¾ªç¯è¯»å–è¿”å›çš„æ•°æ®å—ï¼Œå¹¶æ‹¼æ¥ç»“æœã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># modern/scripts/openai_client.py</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> openai </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OpenAI</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åˆå§‹åŒ–å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OpenAI(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    base_url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://172.18.15.27:8000/v1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æœ¬åœ°è®¿é—®åœ°å€</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;EMPTY&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># VLLMé»˜è®¤ä¸éœ€è¦é‰´æƒ</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    max_retries</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ–°å¢HTTPé‡è¯•</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    timeout</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10.0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å•ç‹¬è®¾ç½®TCPè¿æ¥è¶…æ—¶</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æµå¼è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">stream </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> client.chat.completions.create(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/home/modern/models/Qwen/Qwen2.5-Coder-7B-Instruct-AWQ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   	 	{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;system&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;You are a helpful assistant.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    	{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;å¦‚ä½•ä½¿ç”¨ä½ çš„ç¼–ç¨‹ï¼Œåˆ—ä¸¾å‡ ä¸ªä¾‹å­&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ],</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¯ç”¨æµå¼ä¼ è¾“</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    top_p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.9</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ–°å¢å‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    max_tokens</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4096</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;[ç³»ç»Ÿ] å¼€å§‹ç”Ÿæˆå›ç­”...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">flush</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¤„ç†æµå¼å“åº”</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunk </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> stream:  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ¯ä¸ªchunkä¸­çš„choicesæ˜¯ä¸€ä¸ªåŒ…å«è‡³å°‘ä¸€ä¸ªå¯¹è±¡çš„åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunk.choices[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].delta.content </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#æ¯ä¸ªchoiceå¯¹è±¡æœ‰deltaå±æ€§ï¼Œdeltaé‡Œåˆæœ‰contentã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(content, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">end</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">flush</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>VLLMæ˜¯å¦æ”¯æŒæµå¼ä¼ è¾“ï¼Ÿæ˜¯çš„ï¼ŒVLLMçš„OpenAI APIæ¥å£æ”¯æŒstreamå‚æ•°ï¼Œå½“è®¾ç½®ä¸ºTrueæ—¶ï¼Œä¼šä»¥æµå¼è¿”å›ç»“æœï¼Œæ¯ä¸ªtokené€ä¸ªå‘é€ã€‚</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># modern/scripts/openai_client.py</span></span>
<span class="line"><span>from openai import OpenAI  # å¯¼å…¥OpenAI SDKå®¢æˆ·ç«¯ï¼ˆç”¨äºè¿æ¥å¤§æ¨¡å‹æœåŠ¡ï¼‰</span></span>
<span class="line"><span># åˆå§‹åŒ–OpenAIå®¢æˆ·ç«¯é…ç½®</span></span>
<span class="line"><span>client = OpenAI(</span></span>
<span class="line"><span>    base_url=&quot;http://172.18.15.27:8000/v1&quot;,  # é…ç½®æœ¬åœ°æ¨¡å‹æœåŠ¡çš„APIç«¯ç‚¹åœ°å€</span></span>
<span class="line"><span>    api_key=&quot;EMPTY&quot;              # APIå¯†é’¥ç•™ç©ºï¼ˆå¯èƒ½ç”¨äºå†…éƒ¨æµ‹è¯•ç¯å¢ƒï¼‰</span></span>
<span class="line"><span>)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># å®šä¹‰æµå¼å“åº”å¤„ç†å‡½æ•°</span></span>
<span class="line"><span>def stream_response(prompt):</span></span>
<span class="line"><span>    # åˆ›å»ºæµå¼å“åº”ç”Ÿæˆå™¨ï¼ˆä¿æŒé•¿è¿æ¥å®æ—¶è·å–è¾“å‡ºï¼‰</span></span>
<span class="line"><span>    stream = client.chat.completions.create(</span></span>
<span class="line"><span>        model=&quot;/home/modern/models/Qwen/Qwen2.5-Coder-7B-Instruct-AWQ&quot;,  # æŒ‡å®šæœ¬åœ°æ¨¡å‹è·¯å¾„</span></span>
<span class="line"><span>        messages=[{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: prompt}],         # æ„å»ºå¯¹è¯æ¶ˆæ¯ç»“æ„</span></span>
<span class="line"><span>        stream=True,                             # å¯ç”¨æµå¼è¿”å›æ¨¡å¼</span></span>
<span class="line"><span>        temperature=0.3,                      # è®¾ç½®éšæœºæ€§å‚æ•°ï¼ˆä½å€¼æ›´ç¡®å®šï¼‰</span></span>
<span class="line"><span>        max_tokens=4096,  # ä¼˜åŒ–6ï¼šè°ƒæ•´ä¸ºæ¨¡å‹æ”¯æŒçš„æœ€å¤§å€¼ï¼ˆé¿å…æŠ¥é”™ï¼‰</span></span>
<span class="line"><span>        top_p=0.2,  # æ–°å¢å‚æ•°ï¼ˆä¾‹å¦‚ 0.2ï¼‰ä¼šæå¤§åœ°é™åˆ¶ç”Ÿæˆçš„å†…å®¹ï¼Œå‡å°‘ç»“æœçš„å¤šæ ·æ€§</span></span>
<span class="line"><span>        timeout=30.0,  # ä¼˜åŒ–7ï¼šæ·»åŠ è¶…æ—¶æ§åˆ¶</span></span>
<span class="line"><span>    )</span></span>
<span class="line"><span>    print(&quot;[å¼€å§‹ç”Ÿæˆå›ç­”...]&quot;, end=&quot;  &quot;)</span></span>
<span class="line"><span>    # é€å—å¤„ç†æµå¼è¿”å›å†…å®¹</span></span>
<span class="line"><span>    for chunk in stream:</span></span>
<span class="line"><span>        # æå–å½“å‰å—çš„æ–‡æœ¬å†…å®¹ï¼ˆdeltaè¡¨ç¤ºå¢é‡æ›´æ–°ï¼‰</span></span>
<span class="line"><span>        content = chunk.choices[0].delta.content</span></span>
<span class="line"><span>        if content:                               # è¿‡æ»¤ç©ºå†…å®¹å¹¶å®æ—¶è¾“å‡º</span></span>
<span class="line"><span>            print(content, end=&quot;&quot;, flush=True)         # ç¦ç”¨æ¢è¡Œ+å¼ºåˆ¶ç«‹å³è¾“å‡º</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>if __name__ == &quot;__main__&quot;:</span></span>
<span class="line"><span>    stream_response(&quot;å†™ä¸€ä¸ªPythonæ­£åˆ™è¡¨è¾¾å¼éªŒè¯é‚®ç®±æ ¼å¼&quot;)    # è°ƒç”¨æµå¼å“åº”å‡½æ•°å¹¶ä¼ å…¥æµ‹è¯•æç¤ºè¯</span></span></code></pre></div><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨å¯ä»¥åœ¨PyCharmä¸­å®ç°ï¼š1ï¼‰ä½å»¶è¿Ÿçš„ä»£ç ç”Ÿæˆ 2ï¼‰å®æ—¶æµå¼è¾“å‡º 3ï¼‰å¤šè½®å¯¹è¯æ”¯æŒã€‚å®é™…éƒ¨ç½²æ—¶å»ºè®®ä½¿ç”¨åå‘ä»£ç†ï¼ˆå¦‚Nginxï¼‰å¢å¼ºAPIå®‰å…¨æ€§ã€‚</p><h5 id="openai-clientå®¢æˆ·ç«¯ä»£ç å­˜æ”¾ä½ç½®" tabindex="-1">openai_clientå®¢æˆ·ç«¯ä»£ç å­˜æ”¾ä½ç½® <a class="header-anchor" href="#openai-clientå®¢æˆ·ç«¯ä»£ç å­˜æ”¾ä½ç½®" aria-label="Permalink to &quot;openai_clientå®¢æˆ·ç«¯ä»£ç å­˜æ”¾ä½ç½®&quot;">â€‹</a></h5><p>(1) æ¨èå­˜æ”¾è·¯å¾„ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>modern/</span></span>
<span class="line"><span>â”œâ”€â”€ scripts/</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ qwen_inference.py  # APIæœåŠ¡å™¨å¯åŠ¨è„šæœ¬</span></span>
<span class="line"><span>â”‚   â””â”€â”€ openai_client.py   # æ–°å»ºçš„PyCharmå®¢æˆ·ç«¯ä»£ç  ğŸ‘ˆ æ¨èä½ç½®</span></span></code></pre></div><h2 id="_6-è·¨ç³»ç»Ÿè®¿é—®é…ç½®" tabindex="-1">6. è·¨ç³»ç»Ÿè®¿é—®é…ç½® <a class="header-anchor" href="#_6-è·¨ç³»ç»Ÿè®¿é—®é…ç½®" aria-label="Permalink to &quot;6. è·¨ç³»ç»Ÿè®¿é—®é…ç½®&quot;">â€‹</a></h2><p>è·¨ç³»ç»Ÿè®¿é—®è§„åˆ™ï¼š</p><table tabindex="0"><thead><tr><th style="text-align:left;">åœºæ™¯</th><th style="text-align:left;">æœåŠ¡å™¨ä½ç½®</th><th style="text-align:left;">å®¢æˆ·ç«¯ä½ç½®</th><th style="text-align:left;">é…ç½®è¦ç‚¹</th></tr></thead><tbody><tr><td style="text-align:left;">æœ€ä½³å®è·µ</td><td style="text-align:left;">Ubuntu 20.04</td><td style="text-align:left;">Ubuntu 20.04</td><td style="text-align:left;"><code>base_url=&quot;http://localhost:8000/v1&quot;</code></td></tr><tr><td style="text-align:left;">è·¨ç³»ç»Ÿè®¿é—®</td><td style="text-align:left;">Ubuntu 20.04</td><td style="text-align:left;">Windows 10</td><td style="text-align:left;">éœ€ä¿®æ”¹ä¸ºUbuntuçš„IPï¼š<code>base_url=&quot;http://[Ubuntu_IP]:8000/v1&quot;</code></td></tr></tbody></table><h3 id="windowsè®¿é—®ubuntuæœåŠ¡çš„æ­¥éª¤" tabindex="-1">Windowsè®¿é—®UbuntuæœåŠ¡çš„æ­¥éª¤ï¼š <a class="header-anchor" href="#windowsè®¿é—®ubuntuæœåŠ¡çš„æ­¥éª¤" aria-label="Permalink to &quot;Windowsè®¿é—®UbuntuæœåŠ¡çš„æ­¥éª¤ï¼š&quot;">â€‹</a></h3><ol><li><p>åœ¨Ubuntuç»ˆç«¯æŸ¥çœ‹IPåœ°å€ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ip addr show eth0 | grep &quot;inet &quot;</span></span>
<span class="line"><span>ip a  # æŸ¥çœ‹ens33æˆ–eth0çš„inetåœ°å€</span></span></code></pre></div><p>inet 172.21.136.206/20 brd 172.21.143.255 scope global eth0</p></li><li><p>ä¿®æ”¹å®¢æˆ·ç«¯è¿æ¥åœ°å€ï¼š</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">base_url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://172.21.136.206:8000/v1&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # æ›¿æ¢ä¸ºå®é™…Ubuntu IP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">client </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OpenAI(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    base_url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://172.21.136.206:8000/v1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ›¿æ¢æ­¤å¤„ä¸ºUbuntuçš„å®é™…IP</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;EMPTY&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div></li><li><p>å¼€æ”¾Ubuntué˜²ç«å¢™ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ufw</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> allow</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 8000/tcp</span></span></code></pre></div></li></ol><h4 id="ç½‘ç»œè¿é€šæ€§éªŒè¯" tabindex="-1">ç½‘ç»œè¿é€šæ€§éªŒè¯ <a class="header-anchor" href="#ç½‘ç»œè¿é€šæ€§éªŒè¯" aria-label="Permalink to &quot;ç½‘ç»œè¿é€šæ€§éªŒè¯&quot;">â€‹</a></h4><p>åœ¨Windowså‘½ä»¤æç¤ºç¬¦ä¸­æ‰§è¡Œï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ping</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.21.136.206</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # æµ‹è¯•åŸºç¡€è¿é€šæ€§</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">telnet</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 172.21.136.206</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8000</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # æµ‹è¯•ç«¯å£å¯è¾¾æ€§ï¼ˆéœ€å¼€å¯Telnetå®¢æˆ·ç«¯åŠŸèƒ½ï¼‰</span></span></code></pre></div><p>é¢„æœŸç»“æœï¼š</p><ul><li>pingæˆåŠŸï¼šè¡¨ç¤ºç½‘ç»œå±‚å¯è¾¾</li><li>telnetè¿æ¥æˆåŠŸï¼šè¡¨ç¤ºVLLMçš„8000ç«¯å£å·²å¼€æ”¾</li></ul><p>è¡¥å……è¯´æ˜</p><ol><li><p>åœ°å€ç±»å‹ï¼š<code>172.21.136.206</code> æ˜¯ç§æœ‰åœ°å€ï¼ˆBç±»ç§æœ‰åœ°å€èŒƒå›´ï¼š<code>172.16.0.0~172.31.255.255</code>ï¼‰ï¼Œé€‚ç”¨äºå†…ç½‘ç¯å¢ƒ</p></li><li><p>WSL2ç”¨æˆ·æ³¨æ„ï¼šå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯WSL2ï¼Œéœ€åœ¨Windowsä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯ç”¨ç«¯å£è½¬å‘ï¼š</p><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">netsh interface portproxy add v4tov4 listenport</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> listenaddress</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> connectport</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> connectaddress</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">172.21</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">136.206</span></span></code></pre></div></li></ol><hr><p>æ‚¨ç°åœ¨å¯ä»¥ç›´æ¥åœ¨Windowså®¢æˆ·ç«¯çš„ä»£ç ä¸­ä½¿ç”¨ <code>172.21.136.206:8000</code> è®¿é—®Ubuntuçš„VLLMæœåŠ¡ã€‚</p><h3 id="è·¨ç³»ç»Ÿè®¿é—®é…ç½®-win10â€”â€”ip" tabindex="-1">è·¨ç³»ç»Ÿè®¿é—®é…ç½®-win10â€”â€”IP <a class="header-anchor" href="#è·¨ç³»ç»Ÿè®¿é—®é…ç½®-win10â€”â€”ip" aria-label="Permalink to &quot;è·¨ç³»ç»Ÿè®¿é—®é…ç½®-win10â€”â€”IP&quot;">â€‹</a></h3><h4 id="è·å–å®¿ä¸»æœºçš„å±€åŸŸç½‘ip" tabindex="-1">è·å–å®¿ä¸»æœºçš„å±€åŸŸç½‘IP <a class="header-anchor" href="#è·å–å®¿ä¸»æœºçš„å±€åŸŸç½‘ip" aria-label="Permalink to &quot;è·å–å®¿ä¸»æœºçš„å±€åŸŸç½‘IP&quot;">â€‹</a></h4><p>å¯åŠ¨æœåŠ¡æ—¶éœ€ç»‘å®šåˆ° <code>0.0.0.0</code>ï¼ˆæ‰€æœ‰ç½‘ç»œæ¥å£ï¼‰ï¼Œè€Œéé»˜è®¤çš„ <code>127.0.0.1</code>ã€‚ ä¿®æ­£å‘½ä»¤ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># åœ¨WSLä¸­æ‰§è¡Œï¼ˆç¡®ä¿æ·»åŠ --hostå‚æ•°ï¼‰</span></span>
<span class="line"><span>CUDA_VISIBLE_DEVICES=0 vllm serve /path/to/model \\</span></span>
<span class="line"><span>  --host 0.0.0.0 \\  # å…³é”®ï¼å…è®¸å±€åŸŸç½‘è®¿é—®</span></span>
<span class="line"><span>  --port 8102 \\</span></span>
<span class="line"><span>  --max-model-len 2048 \\</span></span>
<span class="line"><span>  --quantization awq</span></span></code></pre></div><p>åœ¨Windows 10ï¼ˆå®¿ä¸»æœºï¼‰ä¸­æŒ‰ <code>Win+R</code> è¾“å…¥ <code>cmd</code> æ‰§è¡Œï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ipconfig | findstr &quot;IPv4&quot;</span></span></code></pre></div><p>è®°å½•è¾“å‡ºä¸­çš„IPv4åœ°å€ï¼ˆå¦‚ 172.18.15.27ï¼‰ã€‚</p><h4 id="é…ç½®windowsé˜²ç«å¢™" tabindex="-1">é…ç½®Windowsé˜²ç«å¢™ <a class="header-anchor" href="#é…ç½®windowsé˜²ç«å¢™" aria-label="Permalink to &quot;é…ç½®Windowsé˜²ç«å¢™&quot;">â€‹</a></h4><h5 id="_1-å¼€æ”¾ç«¯å£" tabindex="-1">1. å¼€æ”¾ç«¯å£ <a class="header-anchor" href="#_1-å¼€æ”¾ç«¯å£" aria-label="Permalink to &quot;1. å¼€æ”¾ç«¯å£&quot;">â€‹</a></h5><ol><li>æ‰“å¼€ æ§åˆ¶é¢æ¿ â†’ ç³»ç»Ÿå’Œå®‰å…¨ â†’ Windows Defender é˜²ç«å¢™ â†’ é«˜çº§è®¾ç½®</li><li>å³é”® å…¥ç«™è§„åˆ™ â†’ æ–°å»ºè§„åˆ™ â†’ ç«¯å£ â†’ TCP 8102 â†’ å…è®¸è¿æ¥ â†’ å®Œæˆ</li></ol><h5 id="_2-éªŒè¯é˜²ç«å¢™è§„åˆ™" tabindex="-1">2. éªŒè¯é˜²ç«å¢™è§„åˆ™ <a class="header-anchor" href="#_2-éªŒè¯é˜²ç«å¢™è§„åˆ™" aria-label="Permalink to &quot;2. éªŒè¯é˜²ç«å¢™è§„åˆ™&quot;">â€‹</a></h5><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡ŒPowerShell</span></span>
<span class="line"><span>Get-NetFirewallRule | Where-Object { $_.LocalPort -eq 8102 }</span></span></code></pre></div><p>ç¡®ä¿çŠ¶æ€ä¸º <code>Enabled</code> ä¸”åŠ¨ä½œä¸º <code>Allow</code></p><h2 id="_7-å®‰å…¨åŠ å›º-å¯é€‰" tabindex="-1">7.å®‰å…¨åŠ å›ºï¼ˆå¯é€‰ï¼‰ <a class="header-anchor" href="#_7-å®‰å…¨åŠ å›º-å¯é€‰" aria-label="Permalink to &quot;7.å®‰å…¨åŠ å›ºï¼ˆå¯é€‰ï¼‰&quot;">â€‹</a></h2><h4 id="_1-apiå¯†é’¥éªŒè¯" tabindex="-1">1. APIå¯†é’¥éªŒè¯ <a class="header-anchor" href="#_1-apiå¯†é’¥éªŒè¯" aria-label="Permalink to &quot;1. APIå¯†é’¥éªŒè¯&quot;">â€‹</a></h4><p>å¯åŠ¨æœåŠ¡æ—¶æ·»åŠ  <code>--api-key</code> å‚æ•°ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>vllm serve ... --api-key YOUR_SECRET_KEY</span></span></code></pre></div><p>è°ƒç”¨æ—¶éœ€æºå¸¦å¯†é’¥ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>from openai import OpenAI</span></span>
<span class="line"><span>client = OpenAI(</span></span>
<span class="line"><span>    base_url=&quot;http://192.168.1.100:8102/v1&quot;,</span></span>
<span class="line"><span>    api_key=&quot;YOUR_SECRET_KEY&quot;</span></span>
<span class="line"><span>)</span></span></code></pre></div><h4 id="_2-ipç™½åå•é™åˆ¶" tabindex="-1">2. IPç™½åå•é™åˆ¶ <a class="header-anchor" href="#_2-ipç™½åå•é™åˆ¶" aria-label="Permalink to &quot;2. IPç™½åå•é™åˆ¶&quot;">â€‹</a></h4><p>åœ¨Windowsé˜²ç«å¢™ä¸­é…ç½® å…¥ç«™è§„åˆ™ â†’ ä½œç”¨åŸŸ â†’ ä»…å…è®¸ä¸‹åˆ—IPåœ°å€ï¼Œæ·»åŠ å…è®¸çš„å±€åŸŸç½‘IPæ®µï¼ˆå¦‚ <code>192.168.1.0/24</code>ï¼‰</p><h2 id="_8-è·¨è®¾å¤‡è°ƒç”¨ç¤ºä¾‹ä»£ç " tabindex="-1">8.è·¨è®¾å¤‡è°ƒç”¨ç¤ºä¾‹ä»£ç  <a class="header-anchor" href="#_8-è·¨è®¾å¤‡è°ƒç”¨ç¤ºä¾‹ä»£ç " aria-label="Permalink to &quot;8.è·¨è®¾å¤‡è°ƒç”¨ç¤ºä¾‹ä»£ç &quot;">â€‹</a></h2><h4 id="pythonå®¢æˆ·ç«¯-ä»»æ„è®¾å¤‡" tabindex="-1">Pythonå®¢æˆ·ç«¯ï¼ˆä»»æ„è®¾å¤‡ï¼‰ï¼š <a class="header-anchor" href="#pythonå®¢æˆ·ç«¯-ä»»æ„è®¾å¤‡" aria-label="Permalink to &quot;Pythonå®¢æˆ·ç«¯ï¼ˆä»»æ„è®¾å¤‡ï¼‰ï¼š&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>from openai import OpenAI</span></span>
<span class="line"><span># åˆå§‹åŒ–å®¢æˆ·ç«¯</span></span>
<span class="line"><span>client = OpenAI(</span></span>
<span class="line"><span>    base_url=&quot;http://172.18.15.27:8000/v1&quot;,</span></span>
<span class="line"><span>    api_key=&quot;EMPTY&quot;  # è‹¥æœªè®¾ç½®--api-keyåˆ™ç•™ç©º</span></span>
<span class="line"><span>)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>response = client.completions.create(</span></span>
<span class="line"><span>    model=&quot;/home/modern/models/Qwen/Qwen2.5-Coder-7B-Instruct-AWQ&quot;,</span></span>
<span class="line"><span>    prompt=&quot;è¯·å†™ä¸€é¦–å…³äºæ˜¥å¤©çš„è¯—&quot;,</span></span>
<span class="line"><span>    åˆ—ä¸¾ä½¿ç”¨ç¼–ç¨‹åŠŸèƒ½çš„æç¤ºè¯</span></span>
<span class="line"><span>    max_tokens=4096,</span></span>
<span class="line"><span>    top_p=0.1,  # æ–°å¢å‚æ•°</span></span>
<span class="line"><span>    temperature=0.7</span></span>
<span class="line"><span>)</span></span>
<span class="line"><span>print(response.choices[0].text)</span></span></code></pre></div><h4 id="javascript-æµè§ˆå™¨" tabindex="-1">JavaScriptï¼ˆæµè§ˆå™¨ï¼‰ï¼š <a class="header-anchor" href="#javascript-æµè§ˆå™¨" aria-label="Permalink to &quot;JavaScriptï¼ˆæµè§ˆå™¨ï¼‰ï¼š&quot;">â€‹</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>// ç›´æ¥åœ¨æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•</span></span>
<span class="line"><span>fetch(&#39;http://172.18.15.27:8000/v1/completions&#39;, {</span></span>
<span class="line"><span>  method: &#39;POST&#39;,</span></span>
<span class="line"><span>  headers: { &#39;Content-Type&#39;: &#39;application/json&#39; },</span></span>
<span class="line"><span>  body: JSON.stringify({</span></span>
<span class="line"><span>    model: &quot;MyCoder&quot;,</span></span>
<span class="line"><span>    prompt: &#39;å¦‚ä½•å­¦ä¹ æœºå™¨å­¦ä¹ ï¼Ÿ&#39;,</span></span>
<span class="line"><span>    max_tokens: 100</span></span>
<span class="line"><span>  })</span></span>
<span class="line"><span>})</span></span>
<span class="line"><span>.then(response =&gt; response.json())</span></span>
<span class="line"><span>.then(data =&gt; console.log(data.choices[0].text));</span></span></code></pre></div><h2 id="_9-ç¼–å†™apiè°ƒç”¨ä»£ç â€Œ" tabindex="-1">9.ç¼–å†™APIè°ƒç”¨ä»£ç â€Œ <a class="header-anchor" href="#_9-ç¼–å†™apiè°ƒç”¨ä»£ç â€Œ" aria-label="Permalink to &quot;9.ç¼–å†™APIè°ƒç”¨ä»£ç â€Œ&quot;">â€‹</a></h2><p>ä½¿ç”¨Chatæ¨¡å¼â€Œï¼š å¦‚æœæ¨¡å‹æ”¯æŒå¯¹è¯ï¼Œå¯æ”¹ç”¨ /v1/chat/completions æ¥å£ï¼š</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">API_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;http://172.18.15.27:8000/v1&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: prompt}]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨å¯ä»¥åœ¨PyCharmä¸­è½»æ¾è°ƒç”¨VLLMéƒ¨ç½²çš„æ¨¡å‹APIã€‚å¦‚æœéœ€è¦æ›´å¤æ‚çš„äº¤äº’é€»è¾‘ï¼ˆå¦‚å¯¹è¯å†å²ç®¡ç†ï¼‰ï¼Œå¯è¿›ä¸€æ­¥å°è£…APIè¯·æ±‚ã€‚</p>`,82)]))}const g=i(p,[["render",l]]);export{k as __pageData,g as default};
